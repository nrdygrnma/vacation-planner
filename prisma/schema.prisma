generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Airline {
  code String @id
  name String
}

model Currency {
  id             String          @id @default(cuid())
  name           String          @unique
  symbol         String          @unique
  accommodations Accommodation[]
  carRentals     CarRental[]
  flights        Flight[]
  trips          Trip[]
}

model Trip {
  id                  String      @id @default(cuid())
  title               String
  startDate           DateTime?
  endDate             DateTime?
  people              Int         @default(1)
  totalCostEUR        Decimal
  currencyId          String
  selectedFlightId    String?     @unique
  selectedCarRentalId String?     @unique
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  imageUrl            String?
  carRentals          CarRental[] @relation("TripCarRentals")
  flights             Flight[]    @relation("TripFlights")
  selectedCarRental   CarRental?  @relation("SelectedCarOnTrip", fields: [selectedCarRentalId], references: [id])
  selectedFlight      Flight?     @relation("SelectedFlightOnTrip", fields: [selectedFlightId], references: [id])
  currency            Currency    @relation(fields: [currencyId], references: [id])
  tripStops           TripStop[]

  @@index([startDate])
  @@index([endDate])
}

model Flight {
  id                      String    @id @default(cuid())
  airline                 String
  fromAirport             String
  toAirport               String
  departureDate           DateTime?
  arrivalDate             DateTime?
  travelClass             String
  baseFare                Decimal
  extras                  String?
  currencyId              String
  totalCostEUR            Decimal
  tripId                  String
  flightNumber            String?
  stops                   Int?      @default(0)
  bookingUrl              String?
  notes                   String?
  durationMin             Int?
  outboundDurationMin     Int?
  outboundStopoverMin     Int?
  returnDurationMin       Int?
  returnStopoverMin       Int?
  isRoundTrip             Boolean   @default(false)
  returnDepartureDate     DateTime?
  returnArrivalDate       DateTime?
  outboundNetDurationMin  Int?
  returnNetDurationMin    Int?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  stopOverAirports        String?
  stopOverDurationMinutes Int?
  segments                String?
  currency                Currency  @relation(fields: [currencyId], references: [id])
  trip                    Trip      @relation("TripFlights", fields: [tripId], references: [id], onDelete: Cascade)
  selectedOnTrip          Trip?     @relation("SelectedFlightOnTrip")

  @@index([tripId])
  @@index([tripId, departureDate])
  @@index([tripId, totalCostEUR])
}

model CarType {
  id      String      @id @default(cuid())
  name    String      @unique
  rentals CarRental[]
}

model CarRental {
  id              String    @id @default(cuid())
  provider        String
  carTypeId       String?
  pickupDate      DateTime?
  dropoffDate     DateTime?
  pickupLocation  String
  dropoffLocation String
  baseRate        Decimal
  fees            Decimal?
  insurancePerDay Decimal?
  currencyId      String
  totalCostEUR    Decimal?
  notes           String?
  url             String?
  imageUrl        String?
  tripId          String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  carType         CarType?  @relation(fields: [carTypeId], references: [id])
  currency        Currency  @relation(fields: [currencyId], references: [id])
  trip            Trip      @relation("TripCarRentals", fields: [tripId], references: [id], onDelete: Cascade)
  selectedOnTrip  Trip?     @relation("SelectedCarOnTrip")
}

model TripStop {
  id                      String          @id @default(cuid())
  name                    String
  startDate               DateTime
  endDate                 DateTime
  lat                     Float?
  lng                     Float?
  selectedAccommodationId String?         @unique
  tripId                  String
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt
  accommodations          Accommodation[] @relation("TripStopAccommodation")
  selectedAccommodation   Accommodation?  @relation("SelectedAccommodationOnStop", fields: [selectedAccommodationId], references: [id])
  trip                    Trip            @relation(fields: [tripId], references: [id])
}

model Accommodation {
  id             String               @id @default(cuid())
  name           String
  provider       String?
  roomType       String?
  nightlyRate    Decimal?
  totalPrice     Decimal?
  totalCostEUR   Decimal?
  currencyId     String
  tripStopId     String?
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  notes          String?
  url            String?
  currency       Currency             @relation(fields: [currencyId], references: [id])
  tripStop       TripStop?            @relation("TripStopAccommodation", fields: [tripStopId], references: [id])
  selectedOnStop TripStop?            @relation("SelectedAccommodationOnStop")
  images         AccommodationImage[]
}

model AccommodationImage {
  id              String        @id @default(cuid())
  url             String
  accommodationId String
  accommodation   Accommodation @relation(fields: [accommodationId], references: [id], onDelete: Cascade)
}
