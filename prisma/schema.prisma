generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Airline {
  code String @id
  name String
}

model Currency {
  id             String          @id @default(cuid())
  name           String          @unique
  symbol         String          @unique
  accommodations Accommodation[]
  carRentals     CarRental[]
  flights        Flight[]
  trips          Trip[]
}

model Trip {
  id                  String      @id @default(cuid())
  title               String
  startDate           DateTime?
  endDate             DateTime?
  people              Int         @default(1)
  totalCostEUR        Decimal
  currencyId          String
  selectedFlightId    String?     @unique
  selectedCarRentalId String?     @unique
  createdAt           DateTime    @default(now())
  updatedAt           DateTime    @updatedAt
  imageUrl            String?
  carRentals          CarRental[] @relation("TripCarRentals")
  flights             Flight[]    @relation("TripFlights")
  currency            Currency    @relation(fields: [currencyId], references: [id])
  selectedFlight      Flight?     @relation("SelectedFlightOnTrip", fields: [selectedFlightId], references: [id], onDelete: SetNull)
  selectedCarRental   CarRental?  @relation("SelectedCarOnTrip", fields: [selectedCarRentalId], references: [id], onDelete: SetNull)
  tripStops           TripStop[]

  @@index([startDate])
  @@index([endDate])
}

model Flight {
  id                      String    @id @default(cuid())
  airline                 String
  fromAirport             String
  toAirport               String
  departureDate           DateTime?
  arrivalDate             DateTime?
  travelClass             String
  baseFare                Decimal
  extras                  String?
  currencyId              String
  totalCostEUR            Decimal
  tripId                  String
  flightNumber            String?
  stops                   Int?      @default(0)
  bookingUrl              String?
  notes                   String?
  durationMin             Int?
  stopOverDurationMinutes Int?
  stopOverAirports        String?
  segments                Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  trip                    Trip      @relation("TripFlights", fields: [tripId], references: [id], onDelete: Cascade)
  currency                Currency  @relation(fields: [currencyId], references: [id])
  selectedOnTrip          Trip?     @relation("SelectedFlightOnTrip")

  @@index([tripId])
  @@index([tripId, departureDate])
  @@index([tripId, totalCostEUR])
}

model CarType {
  id      String      @id @default(cuid())
  name    String
  rentals CarRental[]
}

model CarRental {
  id              String    @id @default(cuid())
  provider        String
  carTypeId       String?
  pickupDate      DateTime?
  dropoffDate     DateTime?
  pickupLocation  String
  dropoffLocation String
  baseRate        Decimal
  fees            Decimal?
  insurancePerDay Decimal?
  currencyId      String
  totalCostEUR    Decimal?
  tripId          String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  trip            Trip      @relation("TripCarRentals", fields: [tripId], references: [id], onDelete: Cascade)
  currency        Currency  @relation(fields: [currencyId], references: [id])
  carType         CarType?  @relation(fields: [carTypeId], references: [id])
  selectedOnTrip  Trip?     @relation("SelectedCarOnTrip")
}

model TripStop {
  id                      String          @id @default(cuid())
  name                    String
  startDate               DateTime
  endDate                 DateTime
  lat                     Float?
  lng                     Float?
  selectedAccommodationId String?         @unique
  tripId                  String
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt
  accommodations          Accommodation[] @relation("TripStopAccommodation")
  trip                    Trip            @relation(fields: [tripId], references: [id])
  selectedAccommodation   Accommodation?  @relation("SelectedAccommodationOnStop", fields: [selectedAccommodationId], references: [id])
}

model Accommodation {
  id             String    @id @default(cuid())
  name           String
  provider       String?
  roomType       String?
  nightlyRate    Decimal?
  totalCostEUR   Decimal?
  currencyId     String
  tripStopId     String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  tripStop       TripStop? @relation("TripStopAccommodation", fields: [tripStopId], references: [id])
  currency       Currency  @relation(fields: [currencyId], references: [id])
  selectedOnStop TripStop? @relation("SelectedAccommodationOnStop")
}
